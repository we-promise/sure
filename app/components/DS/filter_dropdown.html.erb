<div class="relative" data-controller="dropdown <%= "list-filter" if searchable %> form-dropdown">
  <div class="form-field">
    <input type="hidden" data-form-dropdown-target="input" value="<%= selected_value %>">

    <label class="form-field__label"><%= label %></label>
    <button type="button"
            class="form-field__input"
            data-dropdown-target="button"
            data-action="click->dropdown#toggle">
      <%= selected_item&.dig(:label) || placeholder %>
    </button>
  </div>

  <div class="absolute z-50 my-1.5 p-1.5 w-full min-w-32 rounded-lg shadow-lg hidden shadow-border-xs bg-container"
       data-dropdown-target="menu">
    <% if searchable %>
      <div class="relative flex items-center bg-container border border-secondary rounded-lg mb-1">
        <input type="search"
               placeholder="<%= t("helpers.filter_dropdown.search_placeholder") %>"
               autocomplete="nope"
               class="bg-container placeholder:text-sm placeholder:text-secondary font-normal h-10 pl-10 w-full border-none rounded-lg focus:outline-hidden focus:ring-0"
               data-list-filter-target="input"
               data-action="list-filter#filter">
        <%= helpers.icon("search", class: "absolute inset-0 ml-2 transform top-1/2 -translate-y-1/2") %>
      </div>
    <% end %>

    <div data-list-filter-target="list" class="flex flex-col gap-0.5 max-h-64 overflow-auto">
      <% if items.present? %>
        <% items.each do |item| %>
          <% is_selected = item[:value] == selected_value %>
          <% obj = item[:object] %>

          <div class="filterable-item text-sm cursor-pointer flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-container-inset-hover <%= "bg-container-inset" if is_selected %>"
               data-action="click->dropdown#select"
               data-value="<%= item[:value] %>"
               data-filter-name="<%= item[:label] %>">

            <span class="check-icon <%= "hidden" unless is_selected %>">
              <%= helpers.icon("check") %>
            </span>

            <% case variant %>
            <% when :simple %>
              <%= item[:label] %>

            <% when :icon %>
              <% if logo_for(item) %>
                <%= image_tag logo_for(item),
                      class: "w-6 h-6 rounded-full border border-secondary",
                      loading: "lazy" %>
              <% else %>
                <%= render DS::FilledIcon.new(
                      variant: :text,
                      text: item[:label],
                      size: "sm",
                      rounded: true
                    ) %>
              <% end %>
              <%= item[:label] %>

            <% when :badge %>
              <% hex_color = color_for(item) %>
              <span class="flex items-center gap-1 text-sm font-medium rounded-full px-1.5 py-1 border truncate"
                    style="
                      background-color: color-mix(in oklab, <%= hex_color %> 10%, transparent);
                      border-color: color-mix(in oklab, <%= hex_color %> 20%, transparent);
                      color: <%= hex_color %>;">
                <% if icon_for(item) %>
                  <%= helpers.icon icon_for(item), size: "sm", color: "current" %>
                <% end %>
                <%= item[:label] %>
              </span>
            <% end %>
          </div>
        <% end %>
      <% else %>
        <div class="p-2 text-secondary">
          <%= empty_text %>
        </div>
      <% end %>
    </div>
  </div>
</div>