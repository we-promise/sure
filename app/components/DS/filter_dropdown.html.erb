<div class="relative" data-controller="dropdown <%= "list-filter" if searchable %> form-dropdown">
  <div class="form-field">
    <input type="hidden" data-form-dropdown-target="input" value="<%= selected_value %>">
    
    <label class="form-field__label" for="entry_date"><%= label %></label>
    <button type="button" class="form-field__input" data-dropdown-target="button" data-action="click->dropdown#toggle">
      <%= selected_item&.dig(:label) || placeholder %>
    </button>
  </div>

  <div class="absolute z-50 mt-1.5 w-full rounded-lg shadow-lg hidden shadow-border-xs bg-container rounded-lg" data-dropdown-target="menu">
    <div class="flex flex-col relative" data-controller="list-filter">
      <div class="grow p-1.5">
        <% if searchable %>
          <div class="relative flex items-center bg-container border border-secondary rounded-lg mb-1">
            <input
              placeholder="<%= t("helpers.filter_dropdown.search_placeholder") %>"
              autocomplete="nope"
              type="search"
              class="bg-container placeholder:text-sm placeholder:text-secondary font-normal h-10 relative pl-10 w-full border-none rounded-lg focus:outline-hidden focus:ring-0"
              data-list-filter-target="input" 
              data-action="list-filter#filter">
              <%= helpers.icon("search", class: "absolute inset-0 ml-2 transform top-1/2 -translate-y-1/2") %>
          </div>
        <% end %>
        <div data-list-filter-target="list" class="flex flex-col gap-0.5 max-h-64 overflow-y-scroll scrollbar">
          <% if items.present? %>
            <% items.each do |item| %>
              <% is_selected = item[:value] == selected_value %>

              <% case variant %>
              <% when :simple %>
                <div class="filterable-item cursor-pointer flex text-sm font-medium items-center gap-2 text-secondary w-full rounded-lg px-3 py-2 hover:bg-container-inset-hover <%= "bg-container-inset" if is_selected %>"
                    data-action="click->dropdown#select"
                    data-value="<%= item[:value] %>"
                    data-filter-name="<%= item[:label] %>">
                    <span class="check-icon <%= "hidden" unless is_selected %>">
                      <%= helpers.icon("check") %>
                    </span>
                    <%= item[:label] %>
                </div>

              <% when :icon %>
                <div class="filterable-item cursor-pointer flex text-sm font-medium items-center gap-2 text-secondary w-full rounded-lg px-3 py-2 hover:bg-container-inset-hover <%= "bg-container-inset" if is_selected %>"
                    data-action="click->dropdown#select"
                    data-value="<%= item[:value] %>"
                    data-filter-name="<%= item[:label] %>">
                    <span class="check-icon <%= "hidden" unless is_selected %>">
                      <%= helpers.icon("check") %>
                    </span>
                    <% obj = item[:object] %>
                    <% if item[:value].present? %>
                      <% if obj&.respond_to?(:logo_url) && obj.logo_url.present? %>
                        <%= image_tag Setting.transform_brand_fetch_url(obj.logo_url),
                              class: "w-6 h-6 rounded-full border border-secondary",
                              loading: "lazy" %>
                      <% else %>
                        <div class="flex">
                          <%= render DS::FilledIcon.new(
                            variant: :text,
                            text: item[:label],
                            size: "sm",
                            rounded: true
                          ) %>
                        </div>
                      <% end %>
                    <% end %>
                    <%= item[:label] %>
                </div>

              <% when :badge %>
                <div class="filterable-item cursor-pointer flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-container-inset-hover <%= "bg-container-inset" if is_selected %>"
                    data-action="click->dropdown#select"
                    data-value="<%= item[:value] %>"
                    data-filter-name="<%= item[:label] %>">
                  <span class="check-icon <%= 'hidden' unless is_selected %>">
                    <%= helpers.icon("check") %>
                  </span>
                  <% obj = item[:object] %>
                  <% hex_color = obj&.respond_to?(:color) ? obj.color : DEFAULT_COLOR %>
                  <span class="flex items-center gap-1 text-sm font-medium rounded-full px-1.5 py-1 border truncate focus-visible:outline-none focus-visible:ring-0"
                        style="
                          background-color: color-mix(in oklab, <%= hex_color %> 10%, transparent);
                          border-color: color-mix(in oklab, <%= hex_color %> 20%, transparent);
                          color: <%= hex_color %>;">
                    <% if obj&.respond_to?(:lucide_icon) && obj.lucide_icon.present? %>
                      <%= helpers.icon obj.lucide_icon, size: "sm", color: "current" %>
                    <% end %>
                    <%= item[:label] %>
                  </span>
                </div>
            <% end %>
          <% end %>
          <% else %>
            <div class="p-2 text-secondary">
              <%= empty_text %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
