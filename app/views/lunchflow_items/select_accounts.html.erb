<%= turbo_frame_tag "modal" do %>
  <%= render DS::Dialog.new do |dialog| %>
    <% dialog.with_header(title: t(".title")) %>

    <% dialog.with_body do %>
      <div class="space-y-4">
        <p class="text-sm text-secondary">
          <%= t(".description", product_name: product_name) %>
        </p>

        <%= form_with url: link_accounts_lunchflow_items_path, method: :post, class: "space-y-4", data: { turbo_frame: "_top" } do |form| %>
          <%= hidden_field_tag :accountable_type, @accountable_type %>
          <%= hidden_field_tag :return_to, @return_to %>

          <div class="space-y-2">
            <% @available_accounts.each do |account| %>
              <% has_blank_name = account[:name].blank? %>
              <label class="flex items-start gap-3 p-3 border <%= has_blank_name ? "border-destructive bg-destructive/5" : "border-primary" %> rounded-lg <%= has_blank_name ? "cursor-not-allowed opacity-60" : "hover:bg-surface-hover cursor-pointer" %> transition-colors">
                <%= check_box_tag "account_ids[]", account[:id], false, disabled: has_blank_name, class: "checkbox mt-1" %>
                <div class="flex-1">
                  <div class="font-medium text-sm <%= has_blank_name ? "text-destructive" : "text-primary" %>">
                    <% if has_blank_name %>
                      <%= t(".no_name_placeholder") %>
                    <% else %>
                      <%= account[:name] %>
                    <% end %>
                  </div>
                  <div class="text-xs text-secondary mt-1">
                    <% if account[:iban].present? %>
                      <%= account[:iban] %> •
                    <% end %>
                    <%= account[:institution_name] %> • <%= account[:currency] %> • <%= account[:status] %>
                  </div>
                  <% if has_blank_name %>
                    <div class="text-xs text-destructive mt-1">
                      <%= t(".configure_name_in_lunchflow") %>
                    </div>
                  <% end %>
                </div>
              </label>
            <% end %>
          </div>

          <div class="flex gap-2 justify-end pt-4">
            <%= render DS::Link.new(
                  text: t(".cancel"),
                  href: @return_to || new_account_path,
                  variant: :secondary,
                  data: { turbo_frame: "_top", action: "DS--dialog#close" }
                ) %>
            <%= render DS::Button.new(
                  text: t(".link_accounts"),
                  variant: :primary,
                  type: :submit
                ) %>
          </div>
        <% end %>
      </div>
    <% end %>
  <% end %>
<% end %>