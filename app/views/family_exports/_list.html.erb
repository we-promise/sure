<%= turbo_frame_tag "family_exports",
    data: exports.any? { |e| e.pending? || e.processing? } ? {
      turbo_refresh_url: family_exports_path,
      turbo_refresh_interval: 3000
    } : {} do %>

  <div class="rounded-xl bg-container-inset space-y-1 p-1">
    <div class="flex items-center gap-1.5 px-4 py-2 text-xs font-medium text-secondary uppercase">
      <p>
        <%= t(".exports") %>
      </p>
      <span class="text-subdued">&middot;</span>
      <p><%= @exports.count %></p>
    </div>

    <div class="bg-container rounded-lg shadow-border-xs overflow-x-auto">
      <% if exports.any? %>
        <table class="w-full overflow-x-auto">
          <thead>
            <tr class="text-xs uppercase font-medium text-secondary border-b border-divider">
              <th class="px-2 py-3 text-left min-w-44">
                <%= t("imports.table.date") %>
              </th>
              <th class="px-2 py-3 text-left min-w-64">
                <%= t("imports.table.filename") %>
              </th>
              <th class="px-2 py-3 text-left min-w-24">
                <%= t("imports.table.status") %>
              </th>
              <th class="px-2 py-3 text-right min-w-20">
                <%= t("imports.table.actions") %>
              </th>
            </tr>
          </thead>
          <tbody>
            <% @exports.ordered.each do |export| %>
              <tr class="border-b border-subdued hover:bg-surface-hover">
                <td class="py-3 px-2">
                  <span class="text-sm text-secondary">
                    <%= export.created_at.strftime("%b %-d, %Y %l:%M %p") %>
                  </span>
                </td>
                <td class="py-3 px-2">
                  <span class="text-xs text-secondary truncate">
                    <%= export.filename %>
                  </span>
                </td>
                <td class="py-3 px-2">
                  <% if export.processing? || export.pending? %>
                    <span class="px-1 py text-xs rounded-full bg-gray-500/5 text-secondary border border-alpha-black-50">
                      <%= t(".in_progress") %>
                    </span>
                  <% elsif export.completed? %>
                    <span class="px-1 py text-xs rounded-full bg-green-500/5 text-green-500 border border-alpha-black-50">
                      <%= t(".complete") %>
                    </span>
                  <% elsif export.failed? %>
                    <span class="px-1 py text-xs rounded-full bg-red-500/5 text-red-500 border border-alpha-black-50">
                      <%= t(".failed") %>
                    </span>
                  <% end %>
                </td>
                <td class="py-3 px-2 text-right">
                  <% if export.processing? || export.pending? %>
                    <div class="flex items-center justify-end gap-2 text-secondary">
                      <div class="animate-spin h-4 w-4 border-2 border-secondary border-t-transparent rounded-full"></div>
                      <span class="text-sm">Exporting...</span>
                    </div>
                  <% elsif export.completed? %>
                    <div class="flex items-center gap-2 justify-end">
                      <%= button_to family_export_path(export),
                          method: :delete,
                          class: "flex items-center gap-2 text-destructive hover:text-destructive-hover",
                          data: {
                            turbo_confirm: "Are you sure you want to delete this export? This action cannot be undone.",
                            turbo_frame: "_top"
                          } do %>
                        <%= icon "trash-2", class: "w-5 h-5 text-destructive" %>
                      <% end %>

                      <%= link_to download_family_export_path(export),
                          class: "flex items-center gap-2 text-primary hover:text-primary-hover",
                          data: { turbo_frame: "_top" } do %>
                        <%= icon "download", class: "w-5 h-5" %>
                      <% end %>
                    </div>
                  <% elsif export.failed? %>
                    <div class="flex items-center gap-2">
                      <div class="flex items-center gap-2 text-destructive">
                        <%= icon "alert-circle", class: "w-4 h-4" %>
                      </div>

                      <%= button_to family_export_path(export),
                          method: :delete,
                          class: "flex items-center gap-2 text-destructive hover:text-destructive-hover",
                          data: {
                            turbo_confirm: "Are you sure you want to delete this failed export?",
                            turbo_frame: "_top"
                          } do %>
                        <%= icon "trash-2", class: "w-5 h-5 text-destructive" %>
                      <% end %>
                    </div>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <p class="text-sm text-secondary text-center py-8 font-medium">
          <%= t("imports.index.no_exports") %>
        </p>
      <% end %>
    </div>
  </div>
<% end %>
