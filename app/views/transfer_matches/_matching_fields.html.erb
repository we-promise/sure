<%# locals: (form:, entry:, candidates:, accounts:) %>

<% if candidates.any? %>
  <div data-controller="transfer-match" class="space-y-2">
    <p class="text-sm text-secondary">
      <%= t("transfer_matches.matching_fields.description") %>
    </p>

    <%= form.select :method,
              [
                [t("transfer_matches.matching_fields.match_existing"), "existing"],
                [t("transfer_matches.matching_fields.create_new"), "new"]
              ],
              { selected: "existing", label: t("transfer_matches.matching_fields.matching_method") },
              data: { action: "change->transfer-match#update" } %>

    <div data-transfer-match-target="existingSelect">
      <%= form.select :matched_entry_id,
                candidates.map { |entry|
                  [entry_name_detailed(entry), entry.id]
                },
                { label: t("transfer_matches.matching_fields.matching_transaction") } %>
    </div>

    <div data-transfer-match-target="newSelect" class="hidden">
      <%= form.select :target_account_id,
                accounts.map { |account| [account.name, account.id] },
                { label: t("transfer_matches.matching_fields.target_account") } %>
    </div>
  </div>
<% else %>
  <p class="text-sm text-secondary">
    <%= t("transfer_matches.matching_fields.no_matches_description") %>
  </p>

  <%= form.hidden_field :method, value: "new" %>

  <div>
    <%= form.select :target_account_id,
                accounts.map { |account| [account.name, account.id] },
                { label: t("transfer_matches.matching_fields.target_account") } %>
  </div>
<% end %>
