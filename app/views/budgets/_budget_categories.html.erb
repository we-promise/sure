<%# locals: (budget:) %>

<div>
  <% expense_cats = budget.expense_budget_categories %>
  <% savings_cats = budget.savings_budget_categories %>
  <% expense_groups = BudgetCategory::Group.for(expense_cats) %>
  <% savings_groups = BudgetCategory::Group.for(savings_cats) %>

  <%# Spending Categories Section %>
  <div class="flex items-center gap-1.5 px-4 py-2 text-xs font-medium text-secondary uppercase">
    <p><%= t("budgets.categories.spending_header") %></p>
    <span class="text-subdued">&middot;</span>
    <p><%= expense_cats.size %></p>
    <p class="ml-auto"><%= t("budgets.categories.amount") %></p>
  </div>

  <div class="bg-container py-1 shadow-border-xs rounded-md">
    <% if budget.family.categories.budgetable.empty? %>
      <div class="py-8">
        <%= render "budget_categories/no_categories" %>
      </div>
    <% else %>
      <% expense_groups.each_with_index do |group, index| %>
        <div class="py-2">
          <%= render "budget_categories/budget_category", budget_category: group.budget_category %>

          <div>
            <% group.budget_subcategories.each do |budget_subcategory| %>
              <div class="w-full flex items-start">
                <div class="ml-8 pt-4 flex items-center justify-center text-subdued">
                  <%= icon "corner-down-right" %>
                </div>

                <%= render "budget_categories/budget_category", budget_category: budget_subcategory %>
              </div>
            <% end %>
          </div>
        </div>

        <%= render "shared/ruler" %>
      <% end %>
      <div class="py-2">
        <%= render "budget_categories/budget_category", budget_category: budget.uncategorized_budget_category %>
      </div>
    <% end %>
  </div>

  <%# Savings Categories Section %>
  <% if savings_groups.any? %>
    <div class="flex items-center gap-1.5 px-4 py-2 mt-6 text-xs font-medium text-secondary uppercase">
      <p><%= t("budgets.categories.savings_header") %></p>
      <span class="text-subdued">&middot;</span>
      <p><%= savings_cats.size %></p>
      <p class="ml-auto"><%= t("budgets.categories.amount") %></p>
    </div>

    <div class="bg-container py-1 shadow-border-xs rounded-md">
      <% savings_groups.each_with_index do |group, index| %>
        <div class="py-2">
          <%= render "budget_categories/budget_category", budget_category: group.budget_category %>

          <div>
            <% group.budget_subcategories.each do |budget_subcategory| %>
              <div class="w-full flex items-start">
                <div class="ml-8 pt-4 flex items-center justify-center text-subdued">
                  <%= icon "corner-down-right" %>
                </div>

                <%= render "budget_categories/budget_category", budget_category: budget_subcategory %>
              </div>
            <% end %>
          </div>
        </div>

        <% unless index == savings_groups.length - 1 %>
          <%= render "shared/ruler" %>
        <% end %>
      <% end %>
    </div>
  <% end %>
</div>
