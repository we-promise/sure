<div class="max-w-3xl mx-auto space-y-6">
  <div class="flex items-center justify-between">
    <%= render DS::Link.new(
      text: t("goals.show.back"),
      variant: "ghost",
      href: goals_path,
      icon: "arrow-left"
    ) %>
    <div class="flex items-center gap-2">
      <%= render DS::Link.new(
        text: t("goals.show.edit"),
        variant: "outline",
        href: edit_goal_path(@goal),
        icon: "pen"
      ) %>
      <%= button_to goal_path(@goal), method: :delete, class: "inline-flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-destructive hover:bg-red-50 rounded-lg transition-colors", data: { turbo_confirm: t("goals.show.confirm_delete") } do %>
        <%= icon("trash-2", size: "sm", color: "destructive") %>
        <%= t("goals.show.delete") %>
      <% end %>
    </div>
  </div>

  <%# Header %>
  <div class="bg-container rounded-xl shadow-border-xs p-6">
    <div class="flex items-center gap-4 mb-6">
      <div class="w-14 h-14 rounded-full flex items-center justify-center" style="background-color: color-mix(in oklab, <%= @goal.color %> 15%, transparent); color: <%= @goal.color %>;">
        <%= icon(@goal.lucide_icon || @goal.goal_type_icon, size: "lg", color: "current") %>
      </div>
      <div>
        <h1 class="text-2xl font-medium text-primary"><%= @goal.name %></h1>
        <p class="text-sm text-secondary"><%= t("goals.types.#{@goal.goal_type}") %></p>
      </div>
      <% if @goal.is_completed %>
        <span class="ml-auto inline-flex items-center gap-1 px-3 py-1.5 bg-green-500/10 text-success text-sm font-medium rounded-full">
          <%= icon("check-circle", size: "sm", color: "green") %>
          <%= t("goals.status.completed") %>
        </span>
      <% end %>
    </div>

    <% if @goal.description.present? %>
      <p class="text-sm text-secondary mb-6"><%= @goal.description %></p>
    <% end %>

    <%# Progress ring / bar %>
    <div class="mb-4">
      <div class="flex justify-between items-end mb-2">
        <span class="text-3xl font-medium text-primary"><%= number_to_percentage(@goal.progress_percent, precision: 0) %></span>
        <span class="text-sm text-secondary">
          <%= format_money(@goal.computed_current_amount_money) %>
          <span class="text-subdued"><%= t("goals.show.of") %></span>
          <%= format_money(@goal.target_amount_money) %>
        </span>
      </div>
      <div class="h-3 bg-container-inset rounded-full overflow-hidden">
        <div class="h-full rounded-full transition-all duration-500"
             style="width: <%= @goal.progress_percent %>%; background-color: <%= @goal.color %>"></div>
      </div>
    </div>

    <% if @goal.account.present? %>
      <div class="flex items-center gap-2 text-sm text-secondary mb-4">
        <%= icon("landmark", size: "sm") %>
        <span><%= t("goals.show.linked_to_account") %> <strong class="text-primary"><%= @goal.account.name %></strong></span>
      </div>
    <% end %>

    <%# Details %>
    <dl class="grid grid-cols-2 gap-4 pt-4 border-t border-primary">
      <div>
        <dt class="text-xs text-secondary"><%= t("goals.show.remaining") %></dt>
        <dd class="text-sm font-medium text-primary"><%= format_money(@goal.remaining_amount_money) %></dd>
      </div>
      <% if @goal.target_date %>
        <div>
          <dt class="text-xs text-secondary"><%= t("goals.show.target_date") %></dt>
          <dd class="text-sm font-medium text-primary"><%= @goal.target_date.strftime("%B %d, %Y") %></dd>
        </div>
        <div>
          <dt class="text-xs text-secondary"><%= t("goals.show.days_left") %></dt>
          <dd class="text-sm font-medium text-primary"><%= @goal.days_remaining %></dd>
        </div>
        <div>
          <dt class="text-xs text-secondary"><%= t("goals.show.on_track_label") %></dt>
          <dd class="text-sm font-medium">
            <% if @goal.on_track? %>
              <span class="text-green-500"><%= t("goals.show.on_track") %></span>
            <% else %>
              <span class="text-yellow-500"><%= t("goals.show.behind") %></span>
            <% end %>
          </dd>
        </div>
      <% end %>
    </dl>
  </div>

  <%# Linked budget categories %>
  <% if @goal.budget_categories.any? %>
    <div class="bg-container rounded-xl shadow-border-xs p-6">
      <h2 class="text-sm font-medium text-secondary uppercase mb-4"><%= t("goals.show.linked_categories") %></h2>
      <ul class="space-y-3">
        <% @goal.budget_categories.includes(:category, :budget).each do |bc| %>
          <li class="flex items-center justify-between text-sm">
            <div class="flex items-center gap-2">
              <div class="w-2 h-2 rounded-full" style="background-color: <%= bc.category.color %>"></div>
              <span class="text-primary"><%= bc.category.name %></span>
            </div>
            <span class="text-secondary"><%= format_money(bc.actual_spending_money) %></span>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>
</div>
