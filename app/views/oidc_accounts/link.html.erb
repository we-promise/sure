<%
  header_title @user_exists ? "Link OIDC Account" : "Create Account"
%>

<% if @user_exists %>
  <div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md">
    <h3 class="text-sm font-medium text-yellow-800 mb-2">Verify Your Identity</h3>
    <p class="text-sm text-yellow-700">
      To link your <%= @pending_auth["provider"] %> account<% if @pending_auth["email"].present? %> (<%= @pending_auth["email"] %>)<% end %>,
      please verify your identity by entering your password.
    </p>
  </div>

  <%= styled_form_with url: create_link_oidc_account_path, class: "space-y-4", data: { turbo: false } do |form| %>
    <%= form.email_field :email,
      label: "Email",
      autofocus: false,
      autocomplete: "email",
      required: "required",
      placeholder: "Enter your email",
      value: @email %>

    <%= form.password_field :password,
      label: "Password",
      required: "required",
      placeholder: "Enter your password",
      autocomplete: "current-password" %>

    <div class="text-sm text-gray-600 mt-2">
      <p>This helps ensure that only you can link external accounts to your profile.</p>
    </div>

    <%= form.submit "Link Account" %>
  <% end %>
<% else %>
  <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-md">
    <h3 class="text-sm font-medium text-blue-800 mb-2">Create New Account</h3>
    <p class="text-sm text-blue-700">
      No account found with the email <strong><%= @pending_auth["email"] %></strong>.
      Click below to create a new account using your <%= @pending_auth["provider"] %> identity.
    </p>
  </div>

  <div class="space-y-4">
    <div class="p-4 bg-gray-50 border border-gray-200 rounded-md">
      <p class="text-sm text-gray-700">
        <strong>Email:</strong> <%= @pending_auth["email"] %>
      </p>
      <% if @pending_auth["name"].present? %>
        <p class="text-sm text-gray-700 mt-2">
          <strong>Name:</strong> <%= @pending_auth["name"] %>
        </p>
      <% end %>
    </div>

    <%= button_to "Create Account", create_user_oidc_account_path, method: :post, class: "w-full", data: { turbo: false } %>
  </div>
<% end %>

<div class="mt-6 text-center">
  <%= link_to "Cancel", new_session_path, class: "font-medium text-sm text-primary hover:underline transition" %>
</div>
