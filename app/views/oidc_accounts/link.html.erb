<%
  header_title @user_exists ? t(".link_oidc_account") : t(".create_account_title")
%>

<% if @user_exists %>
  <div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-md">
    <h3 class="text-sm font-medium text-yellow-800 mb-2"><%= t(".verify_identity") %></h3>
    <p class="text-sm text-yellow-700">
      <%= raw t(".verify_identity_description_html", provider: @pending_auth["provider"], email: @pending_auth["email"].presence || "") %>
    </p>
  </div>

  <%= styled_form_with url: create_link_oidc_account_path, class: "space-y-4", data: { turbo: false } do |form| %>
    <%= form.email_field :email,
      label: t(".email"),
      autofocus: false,
      autocomplete: "email",
      required: "required",
      placeholder: t(".email_placeholder"),
      value: @email %>

    <%= form.password_field :password,
      label: t(".password"),
      required: "required",
      placeholder: t(".password_placeholder"),
      autocomplete: "current-password" %>

    <div class="text-sm text-gray-600 mt-2">
      <p><%= t(".security_note") %></p>
    </div>

    <%= form.submit t(".link_account") %>
  <% end %>
<% else %>
  <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-md">
    <h3 class="text-sm font-medium text-blue-800 mb-2"><%= t(".create_new_account") %></h3>
    <p class="text-sm text-blue-700">
      <%= raw t(".no_account_found_html", email: @pending_auth["email"], provider: @pending_auth["provider"]) %>
    </p>
  </div>

  <div class="space-y-4">
    <div class="p-4 bg-container border border-secondary rounded-md">
      <p class="text-sm text-primary">
        <strong><%= t(".email") %>:</strong> <%= @pending_auth["email"] %>
      </p>
      <% if @pending_auth["name"].present? %>
        <p class="text-sm text-primary mt-2">
          <strong>Name:</strong> <%= @pending_auth["name"] %>
        </p>
      <% end %>
    </div>

    <% if @allow_account_creation %>
      <%= render DS::Button.new(
        text: t(".create_account"),
        href: create_user_oidc_account_path,
        full_width: true,
        variant: :primary,
        method: :post,
        data: { turbo: false }
      ) %>
    <% else %>
      <p class="text-xs text-secondary">
        <%= t(".account_creation_disabled") %>
      </p>
    <% end %>
  </div>
<% end %>

<div class="mt-6 text-center">
  <%= render DS::Link.new(
    text: t(".cancel"),
    href: new_session_path,
    variant: :default,
    class: "font-medium text-sm text-primary hover:underline transition"
  ) %>
</div>
