<%
  header_title @user_exists ? t(".title_link") : t(".title_create")
%>

<% if @user_exists %>
  <%= render DS::Alert.new(
        title: t(".verify_identity"),
        message: t(".link_description", provider: @pending_auth["provider"], email: (@pending_auth["email"].present? ? " (#{@pending_auth['email']})" : "")),
        variant: :warning,
        class: "mb-6"
      ) %>

  <%= styled_form_with url: create_link_oidc_account_path, class: "space-y-4", data: { turbo: false } do |form| %>
    <%= form.email_field :email,
      label: t(".email_label"),
      autofocus: false,
      autocomplete: "email",
      required: true,
      placeholder: t(".email_placeholder"),
      value: @email %>

    <%= form.password_field :password,
      label: t(".password_label"),
      required: true,
      placeholder: t(".password_placeholder"),
      autocomplete: "current-password" %>

    <p class="text-sm text-secondary">
      <%= t(".security_notice") %>
    </p>

    <%= form.submit t(".link_button") %>
  <% end %>
<% else %>
  <%= render DS::Alert.new(
        title: t(".heading_create"),
        message: t(".no_account_found", email: tag.strong(@pending_auth["email"]), provider: @pending_auth["provider"]),
        variant: :info,
        class: "mb-6"
      ) %>

  <div class="space-y-4">
    <div class="p-4 bg-container-inset border border-primary rounded-xl shadow-border-xs">
      <p class="text-sm text-primary">
        <strong><%= t(".email_static") %></strong> <%= @pending_auth["email"] %>
      </p>
      <% if @pending_auth["name"].present? %>
        <p class="text-sm text-primary mt-2">
          <strong><%= t(".name_static") %></strong> <%= @pending_auth["name"] %>
        </p>
      <% end %>
    </div>

    <% if @allow_account_creation %>
      <%= render DS::Button.new(
        text: t(".create_button"),
        href: create_user_oidc_account_path,
        full_width: true,
        variant: :primary,
        method: :post,
        data: { turbo: false }
      ) %>
    <% else %>
      <p class="text-xs text-secondary italic">
        <%= t(".account_creation_disabled") %>
      </p>
    <% end %>
  </div>
<% end %>

<div class="mt-8 text-center">
  <%= render DS::Link.new(
    text: t(".cancel"),
    href: new_session_path,
    variant: :ghost,
    size: :sm
  ) %>
</div>