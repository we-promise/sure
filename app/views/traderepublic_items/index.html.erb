<div class="space-y-6">
  <div class="flex items-center justify-between">
    <div>
      <h2 class="text-2xl font-semibold text-primary"><%= t(".title", default: "Trade Republic Connections") %></h2>
      <p class="text-secondary mt-1"><%= t(".description", default: "Manage your Trade Republic broker connections") %></p>
    </div>
    <%= link_to new_traderepublic_item_path, 
                class: "btn btn-primary",
                data: { turbo_frame: "modal" } do %>
      <%= icon "plus", class: "w-4 h-4 mr-2" %>
      <%= t(".new_connection", default: "New Connection") %>
    <% end %>
  </div>

  <% if @traderepublic_items.any? %>
    <div class="space-y-4">
      <% @traderepublic_items.each do |item| %>
        <div class="bg-container border border-secondary rounded-lg p-6">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <div class="flex items-center gap-3">
                <h3 class="text-lg font-medium text-primary"><%= item.name %></h3>
                <% if item.pending_login? %>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                    <%= icon "clock", class: "w-3 h-3 mr-1" %>
                    Pending Verification
                  </span>
                <% elsif item.status_good? %>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    <%= icon "check-circle", class: "w-3 h-3 mr-1" %>
                    Connected
                  </span>
                <% elsif item.status_requires_update? %>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                    <%= icon "alert-circle", class: "w-3 h-3 mr-1" %>
                    Requires Update
                  </span>
                <% end %>
              </div>
              
              <div class="mt-2 space-y-1 text-sm text-secondary">
                <p>
                  <%= icon "phone", class: "w-4 h-4 inline mr-1" %>
                  <%= item.phone_number %>
                </p>
                <% if item.last_synced_at %>
                  <p>
                    <%= icon "refresh-cw", class: "w-4 h-4 inline mr-1" %>
                    Last synced <%= time_ago_in_words(item.last_synced_at) %> ago
                  </p>
                <% end %>
              </div>

              <% if item.traderepublic_accounts.any? %>
                <div class="mt-4">
                  <p class="text-sm font-medium text-primary mb-2">Linked Accounts:</p>
                  <div class="flex flex-wrap gap-2">
                    <% item.traderepublic_accounts.includes(:account).each do |tr_account| %>
                      <div class="inline-flex items-center px-3 py-1 rounded-md bg-gray-100 text-sm">
                        <%= icon "briefcase", class: "w-3 h-3 mr-1" %>
                        <%= tr_account.account&.name || tr_account.name %>
                      </div>
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>

            <div class="flex items-center gap-2 ml-4">
              <% if item.pending_login? %>
                <%= link_to verify_pin_traderepublic_item_path(item),
                            class: "btn btn-sm btn-primary",
                            data: { turbo_frame: "modal" } do %>
                  <%= icon "key", class: "w-4 h-4 mr-1" %>
                  Verify PIN
                <% end %>
              <% elsif item.status_good? %>
                <%= button_to sync_traderepublic_item_path(item),
                              method: :post,
                              class: "btn btn-sm btn-secondary",
                              form: { data: { turbo: false } } do %>
                  <%= icon "refresh-cw", class: "w-4 h-4 mr-1" %>
                  Sync Now
                <% end %>
              <% end %>

              <%= link_to edit_traderepublic_item_path(item),
                          class: "btn btn-sm btn-secondary",
                          data: { turbo_frame: "modal" } do %>
                <%= icon "edit-2", class: "w-4 h-4" %>
              <% end %>

              <%= button_to traderepublic_item_path(item),
                            method: :delete,
                            class: "btn btn-sm btn-secondary text-red-600 hover:text-red-700",
                            form: { data: { turbo_confirm: "Are you sure you want to delete this connection?" } } do %>
                <%= icon "trash-2", class: "w-4 h-4" %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="text-center py-12 bg-container border border-secondary rounded-lg">
      <%= icon "briefcase", class: "w-12 h-12 mx-auto text-gray-400 mb-4" %>
      <h3 class="text-lg font-medium text-primary mb-2">
        <%= t(".no_connections", default: "No Trade Republic connections") %>
      </h3>
      <p class="text-secondary mb-6">
        <%= t(".no_connections_description", default: "Connect your Trade Republic account to sync your portfolio and transactions") %>
      </p>
      <%= link_to new_traderepublic_item_path,
                  class: "btn btn-primary",
                  data: { turbo_frame: "modal" } do %>
        <%= icon "plus", class: "w-4 h-4 mr-2" %>
        <%= t(".add_first_connection", default: "Add Your First Connection") %>
      <% end %>
    </div>
  <% end %>
</div>
