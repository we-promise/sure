<div class="space-y-6">
  <div class="text-sm text-secondary space-y-2">
    <p><strong>Important:</strong> Trade Republic integration uses an unofficial API and requires 2-factor authentication.</p>
    
    <ul class="list-disc list-inside space-y-1 ml-2">
      <li>You'll need your phone number and Trade Republic PIN</li>
      <li>A verification code will be sent to your Trade Republic app during setup</li>
      <li>Sessions are stored securely and will need to be refreshed periodically</li>
    </ul>

    <div class="p-3 bg-warning/10 border border-warning rounded-lg mt-3">
      <p class="text-xs text-warning">
        <%= icon "alert-triangle", class: "inline-block w-4 h-4 mr-1" %>
        <strong>Note:</strong> This integration is based on reverse-engineered API endpoints and may break without notice. Use at your own risk.
      </p>
    </div>
  </div>

  <% items = Current.family.traderepublic_items.where.not(phone_number: nil).order(created_at: :desc) %>
  
  <% if items.any? %>
    <div class="space-y-3">
      <h3 class="text-sm font-medium text-primary">Connected Accounts</h3>
      
      <% items.each do |item| %>
        <div id="traderepublic-item-<%= item.id %>" class="p-4 border border-primary rounded-lg <%= item.status == "requires_update" ? "bg-warning/5 border-warning" : "" %>">
          <div class="flex items-center justify-between">
            <div class="flex-1">
              <div class="flex items-center gap-2">
                <span class="font-medium text-sm text-primary"><%= item.name %></span>
                <% if item.pending_login? %>
                  <span class="px-2 py-0.5 text-xs font-medium rounded-full bg-warning/10 text-warning border border-warning">
                    Pending Verification
                  </span>
                <% elsif item.status == "requires_update" %>
                  <span class="px-2 py-0.5 text-xs font-medium rounded-full bg-error/10 text-error border border-error">
                    Login Required
                  </span>
                <% elsif item.session_configured? %>
                  <span class="px-2 py-0.5 text-xs font-medium rounded-full bg-success/10 text-success border border-success">
                    Connected
                  </span>
                <% end %>
              </div>
              
              <div class="text-xs text-secondary mt-1">
                <% if item.phone_number %>
                  <%= item.phone_number.gsub(/\d(?=\d{4})/, '*') %> •
                <% end %>
                <%= item.traderepublic_accounts.count %> account(s)
                <% if item.last_synced_at %>
                  • Last synced <%= time_ago_in_words(item.last_synced_at) %> ago
                <% end %>
              </div>
            </div>
            
            <div class="flex items-center gap-2">
              <% if item.pending_login? %>
                <%= link_to verify_pin_traderepublic_item_path(item),
                    class: "inline-flex items-center gap-1 px-3 py-1.5 text-xs font-medium rounded-lg text-inverse bg-inverse hover:bg-inverse-hover",
                    data: { turbo_frame: "modal" } do %>
                  <%= icon "shield-check", class: "w-3 h-3" %>
                  <span>Verify PIN</span>
                <% end %>
              <% else %>
                <%= button_to manual_sync_traderepublic_item_path(item),
                    method: :post,
                    class: "inline-flex items-center gap-1 px-3 py-1.5 text-xs font-medium rounded-lg text-primary button-bg-secondary hover:button-bg-secondary-hover",
                    data: { turbo_frame: "modal" } do %>
                  <%= icon "refresh-cw", class: "w-3 h-3" %>
                  <span>Manual sync</span>
                <% end %>
              <% end %>
              
              <%= button_to traderepublic_item_path(item),
                  method: :delete,
                  form: { 
                    data: { 
                      turbo_confirm: "Are you sure you want to disconnect this Trade Republic account?",
                      turbo_frame: "_top"
                    } 
                  },
                  class: "inline-flex items-center gap-1 px-3 py-1.5 text-xs font-medium rounded-lg text-error button-bg-secondary hover:button-bg-secondary-hover" do %>
                <%= icon "trash-2", class: "w-3 h-3" %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="p-4 bg-subtle border border-primary rounded-lg">
      <p class="text-sm text-secondary">
        No Trade Republic accounts connected yet. Use the "Connect Account" button when adding a new account.
      </p>
    </div>
  <% end %>

  <div class="text-xs text-secondary">
    <p><strong>Need help?</strong> Visit the <a href="<%= settings_guides_path %>" class="link">guides</a> for detailed setup instructions.</p>
  </div>
</div>
