<%= content_for :page_title, t(".title") %>

<%= settings_section title: nil, subtitle: t(".description") do %>
  <%= styled_form_with model: @api_key, url: settings_api_key_path, class: "space-y-4" do |form| %>
    <%= form.text_field :name,
        placeholder: t(".name_placeholder"),
        label: t(".name_label"),
        help_text: t(".name_help") %>

    <div>
      <%= form.label :scopes, t(".permissions_label"), class: "block text-sm font-medium text-primary mb-2" %>
      <p class="text-sm text-secondary mb-3"><%= t(".permissions_help") %></p>

      <div class="space-y-2">
        <% [
          ["read", t("settings.api_keys_controller.scope_descriptions.read"), t(".scope_details.read_accounts")],
          ["read_write", t("settings.api_keys_controller.scope_descriptions.read_write"), t(".scope_details.write_transactions")]
        ].each do |value, label, description| %>
          <div class="bg-surface-inset rounded-lg p-3 border border-primary">
            <label class="flex items-start gap-3 cursor-pointer">
              <%= radio_button_tag "api_key[scopes]", value, (@api_key&.scopes || []).include?(value),
                  class: "mt-1" %>
              <div class="flex-1">
                <div class="font-medium text-primary"><%= label %></div>
                <div class="text-sm text-secondary mt-1"><%= description %></div>
              </div>
            </label>
          </div>
        <% end %>
      </div>
    </div>

    <div class="bg-warning-50 border border-warning-200 rounded-xl p-4">
      <div class="flex items-start gap-2">
        <%= icon("alert-triangle", class: "w-5 h-5 text-warning-600 mt-0.5") %>
        <div>
          <h4 class="font-medium text-warning-800 text-sm"><%= t(".security_warning_title") %></h4>
          <p class="text-warning-700 text-sm mt-1">
            <%= t(".security_warning") %>
          </p>
        </div>
      </div>
    </div>

    <div class="flex justify-end gap-3 pt-4 border-t border-primary">
      <%= render DS::Link.new(
        text: t(".cancel"),
        href: settings_api_key_path,
        variant: "ghost"
      ) %>

      <%= render DS::Button.new(
        text: t(".create_key"),
        variant: "primary",
        type: "submit"
      ) %>
    </div>
  <% end %>
<% end %>
