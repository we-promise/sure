<% if @newly_created && @plain_key %>
  <header class="flex items-center justify-between">
    <h1 class="text-primary text-xl font-medium"><%= t(".created_title") %></h1>
  </header>

  <div class="bg-container rounded-xl shadow-border-xs p-4">
    <div class="space-y-4">
      <div class="p-3 shadow-border-xs bg-container rounded-lg">
        <div class="flex items-start gap-3">
          <%= render DS::FilledIcon.new(
            icon: "check-circle",
            rounded: true,
            size: "lg",
            variant: :success
          ) %>
          <div class="flex-1">
            <h3 class="font-medium text-primary"><%= t(".created_success") %></h3>
            <p class="text-secondary text-sm mt-1"><%= t(".created_message", name: @current_api_key.name) %></p>
          </div>
        </div>
      </div>

      <div class="bg-surface-inset rounded-xl p-4">
        <h4 class="font-medium text-primary mb-3"><%= t(".your_api_key") %></h4>
        <p class="text-secondary text-sm mb-3"><%= t(".copy_key_message") %></p>

        <div class="bg-container rounded-lg p-3 border border-primary" data-controller="clipboard">
          <div class="flex items-center justify-between gap-3">
            <code id="api-key-display" class="font-mono text-sm text-primary break-all" data-clipboard-target="source"><%= @current_api_key.plain_key %></code>
            <%= render DS::Button.new(
              text: t(".copy_api_key"),
              variant: "ghost",
              icon: "copy",
              data: { action: "clipboard#copy" }
            ) %>
          </div>
        </div>
      </div>

      <div class="bg-surface-inset rounded-xl p-4">
        <h4 class="font-medium text-primary mb-3"><%= t(".how_to_use") %></h4>
        <p class="text-secondary text-sm mb-3"><%= t(".include_header") %></p>
        <div class="bg-container rounded-lg p-3 font-mono text-sm text-primary border border-primary">
          curl -H "X-Api-Key: <%= @current_api_key.plain_key %>" <%= request.base_url %>/api/v1/accounts
        </div>
      </div>

      <div class="flex justify-end pt-4 border-t border-primary">
        <%= render DS::Link.new(
          text: t(".continue_settings"),
          href: settings_api_key_path,
          variant: "primary"
        ) %>
      </div>
    </div>
  </div>
<% elsif @current_api_key %>
  <header class="flex items-center justify-between">
    <h1 class="text-primary text-xl font-medium"><%= t(".main_title") %></h1>
    <%= render DS::Link.new(
      text: t(".create_new_key"),
      href: new_settings_api_key_path(regenerate: true),
      variant: "secondary"
    ) %>
  </header>

  <div class="bg-container rounded-xl shadow-border-xs p-4">
    <div class="space-y-4">
      <div class="p-3 shadow-border-xs bg-container rounded-lg flex justify-between items-center">
        <div class="flex items-center gap-3">
          <%= render DS::FilledIcon.new(
            icon: "key",
            rounded: true,
            size: "lg"
          ) %>

          <div class="text-sm space-y-1">
            <p class="text-primary font-medium"><%= @current_api_key.name %></p>
            <p class="text-secondary">
              <%= t(".created_ago", time: time_ago_in_words(@current_api_key.created_at)) %>
              <% if @current_api_key.last_used_at %>
                • <%= t(".last_used_ago", time: time_ago_in_words(@current_api_key.last_used_at)) %>
              <% else %>
                • <%= t(".never_used") %>
              <% end %>
            </p>
          </div>
        </div>

        <div class="rounded-md bg-success px-2 py-1">
          <p class="text-success-foreground font-medium text-xs"><%= t(".active") %></p>
        </div>
      </div>

      <div class="bg-surface-inset rounded-xl p-4">
        <h4 class="font-medium text-primary mb-3"><%= t(".permissions") %></h4>
        <div class="flex flex-wrap gap-2">
          <% @current_api_key.scopes.each do |scope| %>
            <span class="inline-flex items-center gap-1 px-2 py-1 bg-primary text-primary-foreground rounded-full text-xs font-medium">
              <%= icon("shield-check", class: "w-3 h-3") %>
              <%= case scope
                  when "read" then t(".scope_read_only")
                  when "read_write" then t(".scope_read_write")
                  else scope.humanize
                  end %>
            </span>
          <% end %>
        </div>
      </div>

      <div class="bg-surface-inset rounded-xl p-4">
        <h4 class="font-medium text-primary mb-3"><%= t(".your_api_key") %></h4>
        <p class="text-secondary text-sm mb-3"><%= t(".copy_key_message") %></p>

        <div class="bg-container rounded-lg p-3 border border-primary" data-controller="clipboard">
          <div class="flex items-center justify-between gap-3">
            <code id="api-key-display" class="font-mono text-sm text-primary break-all" data-clipboard-target="source"><%= @current_api_key.plain_key %></code>
            <%= render DS::Button.new(
              text: t(".copy_api_key"),
              variant: "ghost",
              icon: "copy",
              data: { action: "clipboard#copy" }
            ) %>
          </div>
        </div>
      </div>

      <div class="bg-surface-inset rounded-xl p-4">
        <h4 class="font-medium text-primary mb-3"><%= t(".how_to_use") %></h4>
        <p class="text-secondary text-sm mb-3"><%= t(".include_header") %></p>
        <div class="bg-container rounded-lg p-3 font-mono text-sm text-primary border border-primary">
          curl -H "X-Api-Key: <%= @current_api_key.plain_key %>" <%= request.base_url %>/api/v1/accounts
        </div>
      </div>

      <div class="flex justify-end pt-4 border-t border-primary">
        <%= render DS::Button.new(
          text: t(".revoke_key"),
          href: settings_api_key_path,
          method: :delete,
          variant: "destructive",
          data: {
            turbo_confirm: t(".revoke_confirm")
          }
        ) %>
      </div>
    </div>
  </div>
<% else %>
  <header class="flex items-center justify-between">
    <h1 class="text-primary text-xl font-medium"><%= t(".no_key_title") %></h1>
    <%= render DS::Link.new(
      text: t(".no_key_create_button"),
      href: new_settings_api_key_path,
      variant: "primary"
    ) %>
  </header>

  <div class="bg-container rounded-xl shadow-border-xs p-4">
    <div class="space-y-4">
      <div class="p-3 shadow-border-xs bg-container rounded-lg">
        <div class="flex items-start gap-3">
          <%= render DS::FilledIcon.new(
            icon: "key",
            rounded: true,
            size: "lg"
          ) %>
          <div class="flex-1">
            <h3 class="font-medium text-primary"><%= t(".no_key_heading", product_name: product_name) %></h3>
            <p class="text-secondary text-sm mt-1"><%= t(".no_key_description") %></p>
          </div>
        </div>
      </div>

      <div class="bg-surface-inset rounded-xl p-4">
        <h4 class="font-medium text-primary mb-3"><%= t(".no_key_what_you_can_do") %></h4>
        <ul class="space-y-2 text-sm text-secondary">
          <li class="flex items-start gap-2">
            <%= icon("check", class: "w-4 h-4 text-primary mt-0.5") %>
            <span><%= t(".no_key_feature_1") %></span>
          </li>
          <li class="flex items-start gap-2">
            <%= icon("check", class: "w-4 h-4 text-primary mt-0.5") %>
            <span><%= t(".no_key_feature_2") %></span>
          </li>
          <li class="flex items-start gap-2">
            <%= icon("check", class: "w-4 h-4 text-primary mt-0.5") %>
            <span><%= t(".no_key_feature_3") %></span>
          </li>
        </ul>
      </div>

      <div class="bg-surface-inset rounded-xl p-4">
        <h4 class="font-medium text-primary mb-2"><%= t(".no_key_security_title") %></h4>
        <p class="text-secondary text-sm"><%= t(".no_key_security_note") %></p>
      </div>
    </div>
  </div>
<% end %>
