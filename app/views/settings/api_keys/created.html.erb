<%= content_for :page_title, t(".page_title") %>

<%= settings_section title: t(".created_success"), subtitle: t(".created_description", name: @api_key.name) do %>
  <div class="space-y-4">
    <div class="p-3 shadow-border-xs bg-container rounded-lg">
      <div class="flex items-start gap-3">
        <%= render DS::FilledIcon.new(
          icon: "check-circle",
          rounded: true,
          size: "lg",
          variant: :success
        ) %>
        <div class="flex-1">
          <h3 class="font-medium text-primary"><%= t(".created_success") %></h3>
          <p class="text-secondary text-sm mt-1"><%= t(".created_description", name: @api_key.name) %></p>
        </div>
      </div>
    </div>

    <div class="bg-surface-inset rounded-xl p-4">
      <h4 class="font-medium text-primary mb-3"><%= t(".your_api_key") %></h4>
      <p class="text-secondary text-sm mb-3"><%= t(".copy_store_securely") %></p>

      <div class="bg-container rounded-lg p-3 border border-primary" data-controller="clipboard">
        <div class="flex items-center justify-between gap-3">
          <code id="api-key-display" class="font-mono text-sm text-primary break-all" data-clipboard-target="source"><%= @api_key.plain_key %></code>
          <%= render DS::Button.new(
            text: t(".copy_api_key"),
            variant: "ghost",
            icon: "copy",
            data: { action: "clipboard#copy" }
          ) %>
        </div>
      </div>
    </div>

    <div class="bg-surface-inset rounded-xl p-4">
      <h4 class="font-medium text-primary mb-3"><%= t(".key_details") %></h4>
      <div class="space-y-2 text-sm">
        <div class="flex justify-between">
          <span class="text-secondary"><%= t(".name_label") %></span>
          <span class="text-primary font-medium"><%= @api_key.name %></span>
        </div>
        <div class="flex justify-between">
          <span class="text-secondary"><%= t(".permissions_label") %></span>
          <span class="text-primary">
            <%= @api_key.scopes.map { |scope|
              case scope
              when "read_accounts" then t(".view_accounts")
              when "read_transactions" then t(".view_transactions")
              when "read_balances" then t(".view_balances")
              when "write_transactions" then t(".create_transactions")
              else scope.humanize
              end
            }.join(", ") %>
          </span>
        </div>
        <div class="flex justify-between">
          <span class="text-secondary"><%= t(".created_label") %></span>
          <span class="text-primary"><%= @api_key.created_at.strftime("%B %d, %Y at %I:%M %p") %></span>
        </div>
      </div>
    </div>

    <div class="bg-warning-50 border border-warning-200 rounded-xl p-4">
      <div class="flex items-start gap-2">
        <%= icon("alert-triangle", class: "w-5 h-5 text-warning-600 mt-0.5") %>
        <div>
          <h4 class="font-medium text-warning-800 text-sm"><%= t(".security_note") %></h4>
          <p class="text-warning-700 text-sm mt-1">
            <%= t(".security_note_description") %>
          </p>
        </div>
      </div>
    </div>

    <div class="bg-surface-inset rounded-xl p-4">
      <h4 class="font-medium text-primary mb-3"><%= t(".how_to_use") %></h4>
      <p class="text-secondary text-sm mb-3"><%= t(".usage_instructions") %></p>
      <div class="bg-container rounded-lg p-3 font-mono text-sm text-primary border border-primary">
        curl -H "X-Api-Key: <%= @api_key.plain_key %>" <%= request.base_url %>/api/v1/accounts
      </div>
    </div>

    <div class="flex justify-end pt-4 border-t border-primary">
      <%= render DS::Link.new(
        text: t(".continue_to_settings"),
        href: settings_api_key_path,
        variant: "primary"
      ) %>
    </div>
  </div>
<% end %>
