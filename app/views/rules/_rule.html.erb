<%# locals: (rule:) %>
<div id="<%= dom_id(rule) %>" class="flex justify-between items-center p-4 <%= rule.active? ? "text-primary" : "text-secondary" %>">

  <div class="text-sm space-y-1.5">
    <% if rule.name.present? %>
      <h3 class="font-medium text-md"><%= rule.name %></h3>
    <% end %>
    <% if rule.conditions.any? %>
      <% displayed_condition = rule.displayed_condition %>
      <% additional_condition_count = rule.additional_displayable_conditions_count %>
      <div class="flex items-center gap-2 mt-1">
        <div class="flex items-center gap-1 text-secondary w-16 shrink-0">
          <span class="font-mono text-xs"><%= t("rules.rule.if_label") %></span>
        </div>
        <p class="flex items-center flex-wrap gap-1.5 m-0">
          <span class="px-2 py-1 border border-secondary rounded-full">
            <% if displayed_condition.present? %>
              <%= displayed_condition.filter.label %> <%= displayed_condition.operator %> <%= displayed_condition.value_display %>
            <% else %>
              <%= t("rules.no_condition") %>
            <% end %>
          </span>
          <% if additional_condition_count.positive? %>
            <%= t("rules.rule.and_more_conditions", count: additional_condition_count) %>
          <% end %>
        </p>
      </div>
    <% end %>
    <div class="flex items-center gap-2 mt-1">
      <div class="flex items-center gap-1 text-secondary w-16 shrink-0">
        <span class="font-mono text-xs"><%= t("rules.rule.then_label") %></span>
      </div>
      <p class="flex items-center flex-wrap gap-1.5 m-0">
        <span class="px-2 py-1 border border-secondary rounded-full">
          <% if rule.actions.first.nil? %>
            <%= t("rules.no_action") %>
          <% else %>
            <% if rule.actions.first.value && rule.actions.first.options %>
              <%= rule.actions.first.executor.label %> to <%= rule.actions.first.value_display %>
            <% else %>
              <%= rule.actions.first.executor.label %>
            <% end %>
          <% end %>
        </span>
        <% if rule.actions.count > 1 %>
          <%= t("rules.rule.and_more_actions", count: rule.actions.count - 1) %>
        <% end %>
      </p>
    </div>
    <div class="flex items-center gap-2 mt-1">
      <div class="flex items-center gap-1 text-secondary w-16 shrink-0">
        <span class="font-mono text-xs"><%= t("rules.rule.for_label") %></span>
      </div>
      <p class="flex items-center flex-wrap gap-1.5 m-0">
        <span class="px-2 py-1 border border-secondary rounded-full">
          <% if rule.effective_date.nil? %>
            <%= t("rules.rule.all_past_future", resource_type: rule.resource_type.pluralize) %>
          <% else %>
            <%= t("rules.rule.on_or_after", resource_type: rule.resource_type.pluralize, date: rule.effective_date.strftime("%b %-d, %Y")) %>
          <% end %>
        </span>
      </p>
    </div>
  </div>
  <div class="flex items-center gap-4">
    <%= styled_form_with model: rule, namespace: "rule_#{rule.id}", data: { controller: "auto-submit-form" } do |f| %>
      <%= f.toggle :active, { data: { auto_submit_form_target: "auto" } } %>
    <% end %>
    <%= render DS::Menu.new do |menu| %>
      <% menu.with_item(variant: "link", text: t("rules.rule.edit"), href: edit_rule_path(rule), icon: "pencil", data: { turbo_frame: "modal" }) %>
      <% menu.with_item(variant: "link", text: t("rules.rule.reapply_rule"), href: confirm_rule_path(rule), icon: "refresh-cw", data: { turbo_frame: "modal" }) %>
      <% menu.with_item(
        variant: "button",
        text: t("rules.rule.delete"),
        href: rule_path(rule),
        icon: "trash-2",
        method: :delete,
        confirm: CustomConfirm.for_resource_deletion("rule")) %>
    <% end %>
  </div>
</div>
