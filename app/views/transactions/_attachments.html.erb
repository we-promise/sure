<div class="pb-4">
  <!-- Upload Form -->
  <%= styled_form_with url: transaction_attachments_path(transaction),
        method: :post,
        multipart: true,
        local: true,
        class: "mb-4",
        data: {
          controller: "attachment-upload",
          attachment_upload_max_files_value: Transaction::MAX_ATTACHMENTS_PER_TRANSACTION - transaction.attachments.count,
          attachment_upload_max_size_value: Transaction::MAX_ATTACHMENT_SIZE
        } do |form| %>
    <div class="space-y-3">
      <div>
        <%= form.file_field :attachments,
              multiple: true,
              accept: Transaction::ALLOWED_CONTENT_TYPES.join(','),
              class: "block w-full text-sm border border-primary rounded-lg p-2 bg-container text-primary file:mr-4 file:py-1 file:px-4 file:rounded-md file:border-0 file:text-xs file:font-medium file:bg-surface-inset file:text-primary hover:file:bg-surface-inset-hover cursor-pointer",
              data: { attachment_upload_target: "fileInput" } %>
        <p class="text-xs text-secondary mt-1">
          Select up to <%= Transaction::MAX_ATTACHMENTS_PER_TRANSACTION %> files 
          (images or PDFs, max <%= Transaction::MAX_ATTACHMENT_SIZE / 1.megabyte %>MB each)
          <% if transaction.attachments.any? %>
            â€¢ <%= transaction.attachments.count %> of <%= Transaction::MAX_ATTACHMENTS_PER_TRANSACTION %> used
          <% end %>
        </p>
      </div>

      <%= render DS::Button.new(
            text: "Upload",
            variant: :primary,
            size: :sm,
            data: { attachment_upload_target: "submitButton" }
          ) %>
    </div>
  <% end %>

  <!-- Attachments List -->
  <% if transaction.attachments.any? %>
    <div class="space-y-2">
      <h4 class="text-sm font-medium text-primary">Files (<%= transaction.attachments.count %>)</h4>
      <div class="space-y-2">
        <% transaction.attachments.each do |attachment| %>
          <div class="flex items-center justify-between p-3 border border-primary rounded-lg bg-container">
            <div class="flex items-center gap-3">
              <div class="flex-shrink-0">
                <% if attachment.image? %>
                  <%= icon "image", size: "sm", color: "secondary" %>
                <% else %>
                  <%= icon "file", size: "sm", color: "secondary" %>
                <% end %>
              </div>
              <div class="min-w-0 flex-1">
                <p class="text-sm font-medium text-primary truncate"><%= attachment.filename %></p>
                <p class="text-xs text-secondary"><%= number_to_human_size(attachment.byte_size) %></p>
              </div>
            </div>

            <div class="flex items-center gap-2">
              <%= render DS::Link.new(
                    href: transaction_attachment_path(transaction, attachment),
                    variant: :outline,
                    size: :sm,
                    icon: "download",
                    text: ""
                  ) %>

              <%= render DS::Button.new(
                    href: transaction_attachment_path(transaction, attachment),
                    method: :delete,
                    variant: :outline_destructive,
                    size: :sm,
                    icon: "trash-2",
                    confirm: CustomConfirm.for_resource_deletion("attachment")
                  ) %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% else %>
    <p class="text-sm text-secondary">No attachments yet</p>
  <% end %>
</div>
