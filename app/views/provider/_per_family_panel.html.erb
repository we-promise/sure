<div class="space-y-4">
  <%# Setup instructions and field descriptions %>
  <% if config.provider_description.present? || config.fields.any? { |f| f.description.present? } %>
    <div class="prose prose-sm text-secondary">
      <% if config.provider_description.present? %>
        <%= markdown(config.provider_description).html_safe %>
      <% end %>

      <% if config.fields.any? { |f| f.description.present? } %>
        <p class="text-primary font-medium">Field descriptions:</p>
        <ul>
          <% config.fields.each do |field| %>
            <% if field.description.present? %>
              <li><strong><%= field.label %>:</strong> <%= field.description %></li>
            <% end %>
          <% end %>
        </ul>
      <% end %>
    </div>
  <% end %>

  <%# Error message %>
  <% if error_message.present? %>
    <div class="p-2 rounded-md bg-destructive/10 text-destructive text-sm">
      <%= error_message %>
    </div>
  <% end %>

  <%# Form %>
  <%= styled_form_with model: item,
                       url: per_family_provider_item_path(item, provider_key),
                       scope: "#{provider_key}_item".to_sym,
                       method: per_family_provider_item_method(item),
                       data: { turbo: true },
                       class: "space-y-3" do |form| %>
    <% config.fields.each do |field| %>
      <%
        placeholder = if field.placeholder.present?
          field.placeholder
        elsif is_new_record
          field.default ? "#{field.default} (default)" : "Enter #{field.label.downcase}"
        else
          field.default ? "#{field.default} (default)" : "Enter new #{field.label.downcase} to update"
        end

        # For secret fields on existing records, don't show the value
        field_value = if field.secret && !is_new_record
          nil
        else
          item.public_send(field.name)
        end
      %>

      <%= form.text_field field.name,
                          label: field.label,
                          placeholder: placeholder,
                          type: field.input_type,
                          value: field_value %>
    <% end %>

    <div class="flex justify-end">
      <%= form.submit is_new_record ? "Save Configuration" : "Update Configuration",
                      class: "inline-flex items-center justify-center rounded-lg px-4 py-2 text-sm font-medium text-white bg-gray-900 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-900 focus:ring-offset-2 transition-colors" %>
    </div>
  <% end %>

  <%# Status indicator %>
  <% items = Current.family.send(items_association).select { |i| i.credentials_configured? } %>
  <% if items.any? %>
    <div class="flex items-center gap-2">
      <div class="w-2 h-2 bg-success rounded-full"></div>
      <p class="text-sm text-secondary">
        Configured and ready to use. Visit the <a href="<%= accounts_path %>" class="link">Accounts</a> tab to manage and set up accounts.
      </p>
    </div>
  <% end %>
</div>
